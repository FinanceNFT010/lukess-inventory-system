# REGLAS DEL PROYECTO LUKESS INVENTORY SYSTEM

## ğŸ¯ InformaciÃ³n del Proyecto
- **Nombre**: Lukess Inventory System
- **Stack**: Next.js 15 (App Router), TypeScript, Supabase, Tailwind CSS
- **PropÃ³sito**: Sistema de inventario multi-ubicaciÃ³n para retail de ropa
- **Usuario**: Lukess Home (tienda de ropa boliviana)

## ğŸ“‚ Arquitectura del Proyecto

### Route Groups (CRÃTICO)
app/
â”œâ”€â”€ (auth)/ # Login/Register (NO forma parte de URL)
â”‚ â”œâ”€â”€ login/page.tsx â†’ URL: /login
â”‚ â””â”€â”€ register/page.tsx â†’ URL: /register
â”œâ”€â”€ (dashboard)/ # App principal (NO forma parte de URL)
â”‚ â”œâ”€â”€ page.tsx â†’ URL: / (Dashboard)
â”‚ â”œâ”€â”€ inventario/ â†’ URL: /inventario
â”‚ â”œâ”€â”€ ventas/ â†’ URL: /ventas
â”‚ â”œâ”€â”€ reportes/ â†’ URL: /reportes
â”‚ â””â”€â”€ layout.tsx # Sidebar + Auth check
â””â”€â”€ layout.tsx # Root layout

text

**REGLA FUNDAMENTAL**: `(auth)` y `(dashboard)` son route groups, NO aparecen en URLs.

## ğŸ—„ï¸ Base de Datos (Supabase)

### Schema Principal
```sql
organizations    # Tiendas/organizaciones
  â””â”€ profiles         # Usuarios
  â””â”€ categories       # CategorÃ­as de productos
  â””â”€ locations        # Ubicaciones fÃ­sicas (puestos)
  â””â”€ products         # Productos base
      â””â”€ inventory    # Stock por ubicaciÃ³n
      â””â”€ sales        # Ventas (header)
          â””â”€ sale_items  # LÃ­neas de venta
RLS (Row Level Security)
Todas las tablas filtran por org_id

FunciÃ³n helper: get_user_org_id()

Siempre incluir org_id en INSERT/UPDATE/DELETE

Orden de Operaciones (Foreign Keys)
Para eliminar producto:

Verificar sale_items (si tiene ventas â†’ error)

DELETE inventory primero

DELETE products despuÃ©s

ğŸ¨ Reglas de DiseÃ±o
CONTRASTE Y COLORES (SUPER CRÃTICO)
NUNCA HACER:

âŒ text-white sobre bg-white

âŒ text-red-600 sobre bg-red-600

âŒ Gradientes sin text-white explÃ­cito

âŒ Botones sin hover states

SIEMPRE HACER:

tsx
// Botones con gradiente
<button className="bg-gradient-to-r from-blue-600 to-purple-600 text-white hover:from-blue-700 hover:to-purple-700">

// Botones de acciÃ³n roja
<button className="bg-red-600 text-white hover:bg-red-700">

// Botones de acciÃ³n azul
<button className="bg-blue-600 text-white hover:bg-blue-700">

// Iconos con hover
<button className="text-blue-600 hover:bg-blue-50 p-2 rounded-lg">
Paleta de Colores del Sistema
Elemento	Background	Text	Border	Uso
Dashboard - Total Productos	bg-blue-50	text-blue-600/800	border-blue-200	MÃ©tricas
Dashboard - Stock Total	bg-green-50	text-green-600/800	border-green-200	Inventario
Dashboard - Ventas	bg-purple-50	text-purple-600/800	border-purple-200	Financiero
Dashboard - Bajo Stock	bg-red-50	text-red-600/800	border-red-200	âš ï¸ Alertas
BotÃ³n Primario	gradient blue-purple	text-white	-	Acciones principales
BotÃ³n Eliminar	bg-red-600	text-white	-	Destructivo
BotÃ³n Editar	hover:bg-blue-50	text-blue-600	-	Modificar
Cards del Dashboard (Template)
tsx
<div className="bg-{color}-50 rounded-xl p-6 border-2 border-{color}-200 hover:shadow-lg transition-all">
  <div className="flex items-start justify-between">
    <div>
      <p className="text-{color}-800 text-sm font-medium mb-1">{label}</p>
      <p className="text-4xl font-bold text-{color}-600">{value}</p>
      <p className="text-{color}-700 text-sm mt-1">{subtitle}</p>
    </div>
    <div className="bg-{color}-100 p-3 rounded-full">
      <Icon className="w-10 h-10 text-{color}-600" />
    </div>
  </div>
</div>
Iconos EstÃ¡ndar (lucide-react)
Dashboard: Home

Inventario: Package

Ventas/POS: ShoppingCart

Reportes: BarChart3

ConfiguraciÃ³n: Settings

Alerta: AlertTriangle (ROJO para bajo stock)

Editar: Pencil

Eliminar: Trash2

Ã‰xito: Check

Error: X

ğŸ’° Margen de Ganancia (Feature Especial)
Siempre mostrar en formularios de producto (nuevo/editar):

tsx
{formData.price && formData.cost && (
  <div className="p-4 bg-green-50 rounded-lg border-2 border-green-200">
    <div className="flex items-center justify-between">
      <div>
        <p className="text-sm text-green-700 font-medium">Margen de Ganancia</p>
        <p className="text-2xl font-bold text-green-600 mt-1">
          {((parseFloat(formData.price) - parseFloat(formData.cost)) / parseFloat(formData.cost) * 100).toFixed(1)}%
        </p>
      </div>
      <div className="text-right">
        <p className="text-sm text-green-700 font-medium">Ganancia por unidad</p>
        <p className="text-xl font-bold text-green-600 mt-1">
          +Bs {(parseFloat(formData.price) - parseFloat(formData.cost)).toFixed(2)}
        </p>
      </div>
      <TrendingUp className="w-8 h-8 text-green-500" />
    </div>
  </div>
)}
ğŸ“ Convenciones de CÃ³digo
TypeScript
Usar 'use client' en componentes con interactividad

Server Components por defecto

Siempre tipar con TypeScript

Interfaces sobre types

Manejo de Errores
typescript
try {
  // OperaciÃ³n
  const { data, error } = await supabase.from('table').select()
  
  if (error) throw error
  
  toast.success('OperaciÃ³n exitosa')
  router.refresh()
  
} catch (error) {
  console.error('Error:', error)
  toast.error('Error al realizar operaciÃ³n')
}
Validaciones
Usar Zod para validaciÃ³n de formularios

Validar en cliente Y servidor

Mensajes de error claros y especÃ­ficos

Loading States
typescript
const [isLoading, setIsLoading] = useState(false)

// En botones
<button disabled={isLoading}>
  {isLoading ? 'Cargando...' : 'AcciÃ³n'}
</button>
ğŸ”§ Operaciones Comunes
Crear Producto
typescript
// 1. Validar campos requeridos
if (!sku || !name || !price || !cost) return

// 2. INSERT producto
const { data: product } = await supabase
  .from('products')
  .insert({
    org_id: userOrgId,
    sku, name, price, cost,
    category_id: categoryId || null,  // OPCIONAL
    sizes: sizes.length > 0 ? sizes : null,
    colors: colors.length > 0 ? colors : null
  })
  .select()
  .single()

// 3. INSERT inventory por ubicaciÃ³n
const inventoryData = Object.entries(stockByLocation).map(([locId, qty]) => ({
  org_id: userOrgId,
  product_id: product.id,
  location_id: locId,
  quantity: Number(qty)
}))

await supabase.from('inventory').insert(inventoryData)
Editar Producto
typescript
// 1. UPDATE producto
await supabase
  .from('products')
  .update({ sku, name, price, cost, ... })
  .eq('id', productId)

// 2. Actualizar inventory
await supabase.from('inventory').delete().eq('product_id', productId)
await supabase.from('inventory').insert(newInventoryData)
Eliminar Producto
typescript
// 1. Verificar ventas
const { data: sales } = await supabase
  .from('sale_items')
  .select('id')
  .eq('product_id', productId)
  .limit(1)

if (sales?.length > 0) {
  toast.error('No se puede eliminar: tiene ventas registradas')
  return
}

// 2. Eliminar inventory primero
await supabase.from('inventory').delete().eq('product_id', productId)

// 3. Eliminar producto
await supabase.from('products').delete().eq('id', productId)
Ordenar por Columna Calculada
typescript
// Stock Total es suma de inventory
const sorted = products.map(p => ({
  ...p,
  calculated_stock: p.inventory?.reduce((sum, inv) => sum + inv.quantity, 0) || 0
})).sort((a, b) => 
  sortDirection === 'asc' 
    ? a.calculated_stock - b.calculated_stock 
    : b.calculated_stock - a.calculated_stock
)
ğŸ¯ Flujos de Usuario Clave
Dashboard
Verificar autenticaciÃ³n

Cargar mÃ©tricas (4 cards)

Mostrar productos bajo stock

Mostrar Ãºltimas ventas

Inventario
Listar productos con stock por ubicaciÃ³n

Filtros: categorÃ­a, ubicaciÃ³n, bajo stock

BÃºsqueda por SKU/nombre

Acciones: editar, eliminar

POS (Punto de Venta)
Buscar productos (scanner/manual)

Agregar al carrito

Seleccionar mÃ©todo de pago

Registrar venta

Actualizar inventory

Crear Producto
Datos bÃ¡sicos (SKU, nombre, precio, costo)

CategorÃ­a (opcional)

Tallas y colores (opcional)

Stock inicial por ubicaciÃ³n

Mostrar margen de ganancia

Validar y crear

ğŸš¨ Problemas Comunes y Soluciones
"404 en rutas del dashboard"
Verificar que app/page.tsx NO existe

app/(dashboard)/page.tsx debe ser la raÃ­z /

"Error al eliminar producto"
Verificar orden: sale_items â†’ inventory â†’ products

Verificar RLS policies de DELETE

"CategorÃ­a no se guarda"
category_id debe ser NULL si estÃ¡ vacÃ­o

No usar required en el select

"Stock Total no ordena"
Es campo calculado, usar calculated_stock

Ver ejemplo en "Ordenar por Columna Calculada"

"Botones invisibles"
Verificar contraste: text-white en gradientes

Verificar: bg-red-600 text-white (NO text-red-600)

ğŸ“Š MÃ©tricas y Analytics (Futuro)
Total productos activos

Stock total en sistema

Ventas diarias/semanales/mensuales

Productos mÃ¡s vendidos

Alertas de restock automÃ¡tico

ğŸ” Seguridad
RLS habilitado en todas las tablas

ValidaciÃ³n cliente + servidor

SanitizaciÃ³n de inputs

Tokens JWT para auth

Secrets en .env.local

ğŸ“ Recursos
Next.js 15 docs: https://nextjs.org/docs

Supabase docs: https://supabase.com/docs

Tailwind CSS: https://tailwindcss.com

shadcn/ui: https://ui.shadcn.com

âš ï¸ IMPORTANTE: Antes de Modificar CÃ³digo
Lee .cursorrules completo

Verifica que entiendes la arquitectura

Consulta el schema de Supabase

Prueba en desarrollo antes de producciÃ³n

Commitea cambios frecuentemente

ğŸ¤ Para el Equipo
Este sistema estÃ¡ diseÃ±ado para retail de ropa

MÃºltiples ubicaciones fÃ­sicas

Control de stock en tiempo real

POS integrado

Reportes de ventas

MantÃ©n estas reglas actualizadas conforme el proyecto evoluciona.